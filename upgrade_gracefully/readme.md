通常我们的服务进程和前端或者后端保持了长连接，持续的传输数据，例如正在进行实时音视频。

如果这时候简单粗暴的重启和发布，会导致用户体验受损。这也是为什么我们经常在业务低峰的三更半夜发布的原因。所以探讨这个问题对我们工作有实际的意义。

有没有办法做到重启和更新进程，同时不断开长连接呢？ 至少有三个方案：

方案1、fork + exec启动新版本进程，在此之前在老进程里对需要保持的长连接的fd 清除 FD_CLOEXEC标记

方案2、新老版本进程之间，通过sendmsg/recvmsg来传递需要保持的长连接的fd，还保持连接不断

方案3、用一个专门的独立进程gw来处理长连接，通常gw不需要升级和重启，gw和业务逻辑处理进程中间通过某种IPC机制传递业务报文。



echo.c  echo2.c分别演示了方案1和方案2